{
  "problem_code": "problems",
  "title": "Happy Valentine Day (Valentine Adventure Game)",
  "tags": [],
  "text": "Happy valentine day! In this problem you'll play adventure game, where you should bring chocolate to your home on 1D virtual world. You start from location 0 and your home located onh. You will take the journey from 0 tohbut in the middle of your way to home there could be some bad person who want to steal your chocolate, so you will war with them, if you win, you'll continue the journey, else you'll restart the game. There also some flag, if you successfully take the flag, when you restart the game you'll continue at that flag location but you lose that flag and try to take that flag again, if you take multiple flag, the latest flag that you take will be used and the other flag that you successfully take will be keep.Now given the map that contain all flag location + probability that you'll successfully take that flag, all war location + probability that you'll win the war, and your home location. Calculate the expected time needed to finish the game. Assume your move speed is constant: 1 unit per time and you do the war and take the flag in no time.InputThere are multiple test case in one file,For each test case:- First line there are two integershandqdenoting the home location and number of object between 0 andh.- Nextqlines there are one character and 3 integers,c,n,a,b:cis denoting the type of object ('X' means war, and 'F' means flag)nis denoting the location of object, it's guaranteed thatnwill be strictly increasing (larger than previousn)aandbdenoting numerator and denominator the probability, so the probability isa/b.The last line in input file there are two zeros, indicating end of sequence of cases, and your program should terminate.OutputFor each test case output the expected time needed to finish the game. Since the answer could be very large, output it modulo 109+7. All cases is designed such that it's guaranteed the expected time will be an integer.Constraints0 <h≤ 10180 ≤q≤ 1040 <n<h0 <b< 109+70 <a≤bInput File Size < 500 KBExampleInput:32 0\r\n32 1\r\nX 16 1 2\r\n32 2\r\nF 8 1 1\r\nX 16 1 2\r\n32 2\r\nF 8 1 2\r\nX 16 1 2\r\n0 0Output:32\r\n48\r\n40\r\n44See also:Another problem added by Tjandra Satria Gunawan",
  "sample_input": "Input:32 0\r\n32 1\r\nX 16 1 2\r\n32 2\r\nF 8 1 1\r\nX 16 1 2\r\n32 2\r\nF 8 1 2\r\nX 16 1 2\r\n0 0Output:32\r\n48\r\n40\r\n44",
  "sample_output": "Not found",
  "link": "https://www.spoj.com/problems/VAL_GAM4",
  "scraped_at": "2025-08-17 00:34:32"
}