{
  "problem_code": "problems",
  "title": "Bundling",
  "tags": [],
  "text": "Outel, a famous semiconductor company, recently released a new model of\r\n  microprocessor called Platinium. Like many modern processors, Platinium can\r\n  execute many instructions in one clock step providing that there are no\r\n  dependencies between them (instruction I2is dependent on\r\n  instruction I1if for example I2reads a register that I1writes to). Some processors are so clever that they calculate on the fly which\r\n  instructions can be safely executed in parallel. Platinium however expects this\r\n  information to be explicitly specified. A special marker, called simply a stop,\r\n  inserted between two instructions indicates that some instructions after the\r\n  stop are possibly dependent on some instructions before the stop. In other\r\n  words instructions between two successive stops can be executed in parallel and\r\n  there should not be dependencies between them.Another interesting feature of Platinium is that an instruction sequence must\r\n  be split into groups of one, two or three successive instructions. Each group\r\n  has to be packed into a container called a bundle. Each bundle has 3 slots and\r\n  a single instruction can be put into each slot, however some slots may stay\r\n  empty. Each instruction is categorized into one of 10 instruction types denoted\r\n  by consecutive capital letters from A to J (instructions of the same type have\r\n  similar functionality, for example type A groups integer arithmetic\r\n  instructions and type F groups instructions). Only instructions of certain\r\n  types are allowed to be packed into one bundle. A template specifies one\r\n  permissible combination of instruction types within a bundle. A template can\r\n  also specify a position of a stop in the middle of a bundle (there is at most\r\n  one such stop allowed). In addition, stops are allowed between any two\r\n  adjoining bundles. A set of templates is called a bundling profile. When\r\n  packing instructions into bundles, one has to use templates from bundling\r\n  profile only.Although Platinium is equipped with an instruction cache it was found that for\r\n  maximal performance it is most crucial to pack instructions as densely as\r\n  possible. Second important thing is to use a small number of stops.Your task is to write a program for bundling Platinium instructions. For the\r\n  sake of simplicity we assume that the instructions cannot be reordered.TaskWrite a program that:reads a bundling profile and a sequence of instructions,computes the minimal number of bundles into which the sequence can be packed\r\n  without breaking the dependencies and the minimal number of all stops that are\r\n  required for the minimal number of bundles,writes the result.InputThe input begins with the integer z, the number of test cases. Then z test\r\n  cases follow.The first line of each test case descripition contains two integers t and n\r\n  separated by a single space. Integer t (1 ≤ t ≤ 1500) is the number of\r\n  templates in the bundling profile. Integer n (1 ≤ n ≤ 100000) is the\r\n  number of instructions to be bundled.Each of the next t lines specifies one template and contains 3 capital letters\r\n  t1, t2, t3with no spaces in between followed by\r\n  a space and an integer p. Letter ti(A ≤ ti≤ J)\r\n  is an instruction type allowed in the i-th slot. Integer p (0 ≤ p ≤ 2)\r\n  is the index of the slot after which the stop is positioned (0 means no stop\r\n  within the bundle).Each of the next n lines specifies one instruction. The i-th line of these n\r\n  lines contains one capital letter ciand an integer di,\r\n  separated by a single space. Letter ci(A ≤ ci≤ J)\r\n  is the type of the i-th instruction. Integer di(0 ≤ di< i) is the index of the last instruction (among the previous ones) that the\r\n  i-th instruction is dependent on (0 means that the instruction is not dependent\r\n  on any former instruction).You can assume that for each instruction type c describing an instruction in\r\n  the instruction sequence there is at least one template containing c.OutputFor each test case, the first and only line of the output contains two integers\r\n  b and s. Integer b is the minimal number of bundles in a valid packing. Integer\r\n  s is the minimal number of all stops that are required for the minimal number\r\n  of bundles.ExampleInput:1\r\n4 9\r\nABB 0\r\nBAD 1\r\nAAB 0\r\nABB 2\r\nB 0\r\nB 1\r\nA 1\r\nA 1\r\nB 4\r\nD 0\r\nA 0\r\nB 3\r\nB 0Output:4 3Warning: large Input/Output data, be careful with certain languages",
  "sample_input": "Input:1\r\n4 9\r\nABB 0\r\nBAD 1\r\nAAB 0\r\nABB 2\r\nB 0\r\nB 1\r\nA 1\r\nA 1\r\nB 4\r\nD 0\r\nA 0\r\nB 3\r\nB 0Output:4 3",
  "sample_output": "Not found",
  "link": "https://www.spoj.com/problems/BUNDLE",
  "scraped_at": "2025-08-17 00:33:39"
}