{
  "problem_code": "problems",
  "title": "Chessboard State 3: Intergalactic Chess Tournament",
  "tags": [],
  "text": "Note: This is a harder version of CSTATE1 and CSTATE2 - a solution to this problem will (except I/O format) pass there.V Slovakistane sa rozhodli osadníci usporiadať národný šachový turnaj.Za prvé miesto sa dá získať diplom, a tak všetci hrajú ako o život.Keďže sa však nehrá na čas, vyskytol sa problém -- hráči nechceli priznať prehru.Stále len tvrdili, že určite nemajú mat, však určite sa z tej situácie dá nejak dostať, keby len mali ešte chvíľku na rozmýšlanie... A možno ešte jednu...Na budúci rok sa bude TMŠ v Slovakistane organizovať zas, ale je potrebné tento problém dovtedy nejako vyriešiť.## ÚlohaPre daný popis šachovnice rozlíšte, či má niektorý z hráčov šach alebo mat.Pritom berte do úvahy len obyčajné pohyby figúrok (komplikované ťahy ako*rošáda*, *en passant*, *pohyb pešiakom o dva políčka vpred* a*povýšenie pešiaka* sa v Slovakistane neakceptujú).## Formát vstupuV prvom riadku je číslo $1 \\leq t \\leq 1000$, udávajúce počet šachovníc na vstupe.Nasleduje $t$ popisov šachovníc.Každý popis šachovnice pozostáva z ôsmich riadkov, každý obsahujúciosem znakov (teda šachovnica má klasické rozmery $8 \\times 8$).Tieto znaky sú `.KQRBHP`, reprezentujúce v tomto poradí voľnépolíčko, kráľa, kráľovnú, vežu, strelca, koňa, a pešiaka.Bielemu hráčovi patrí horná strana šachovnice (skôr na vstupe) a jehofigúrky sú označené malými písmenami. Teda bieli pešiaci sa pohybujúsmerom dole.Čiernemu hráčovi patrí dolná strana šachovnice a jeho figúrky súoznačené veľkými písmenami. Jeho pešiaci sa pohybujú smerom hore.Za každým popisom šachovnice je jeden prázdny riadok.Počet ani poloha figúrok nijak nemusia byť dosiahnuteľné vklasickej hre šachu, avšak môžete predpokladať, že na každejšachovnici sa nachádza práve jeden biely kráľ (`k`) a práve jedenčierny kráľ (`K`).Navyše, figúrky sa vo vstupoch budú vyskytovať nasledovne:| Číslo sady | Nové figúrky|| :--------: |------------------||$1$| Kráľ, kôň||$2$| Veža||$3$| Strelec, kráľovná||$4$| Pešiak|## Formát výstupuPre každú šachovnicu vypíšte jeden riadok s jednou z nasledovných hlášok:+   \"Neutralna situacia.\", ak žiaden z kráľov nie je ohrozený nepriateľskou figúrkou.+   \"Nemozna situacia.\", ak sú obaja králi ohrození nepriateľskou figúrkou.+   \"{farba} hrac ma sach.\", kde {farba} je \"Biely\", resp. \"Cierny\", akje kráľ tohto hráča v ohrození, ale existuje platný ťah niektorouz jeho figúrok taký, po ktorom už v ohrození nebude.+   \"{farba} hrac ma mat.\", kde {farba} je \"Biely\", resp. \"Cierny\", ak jekráľ tohto hráča v ohrození, a neexistuje platný ťah niektorou z jehofigúrok taký, po ktorom už v ohrození nebude.A thousand years ago the inhabitants of Slovakistan decided to organize a national chess tournament.Since the first place prize was 1 point on SPOJ, everyone played as if their life was at stake.However, since time was not measured in this chess tournament (unlike at most chess tournaments in the rest of the world), a problem occured - players took way too long to admit defeat.They always just kept thinking and thinking, trying to find some move which would prevent their king from being taken. Just one more moment... And perhaps one more...Luckily, a skilled programmer lent them a hand and got rid of this nuisance!The next year, they organized a chess tournament once more. However, since word got out of how awesome it was, contestants from all over the world joined. Slovakistan could not embarras itself - that year's tournament had to be more awesome, way more dramatic, and - most importantly - a whole lot bigger. Hence, during that year's tournament the contestants did not only play on the classic 8-by-8 chessboards, but rather on n-by-n boards.That gave rise to a new problem though - the programs of skilled programmers which helped them the previous year were not capable of deciding the state of chessboards of such size!Once again, the inhabitants of Slovakistan needed help.That is the origin story of the now most popular tournament in the entire universe. These days all the galactic empires have a ceasefire in the intergalactic wars to all take part in the Intergalactic Chess Tournament. For its thousandth aniversary, the Slovakistan Milky Way Empire is preparing a truly spectacular show - the chesspieces this year will be represented by planets, and the chessboard will be an entire galaxy!As in the legendary tale from a thousand years ago, they are facing the same problem: the programs written to decide the state of a chessboard can not handle the size of the chessboard, even when run on the most modern quantum computers. To tackle this problem, they have constructed a time machine to come to this legendary time - and look for a skilled programer who could help them with this task!For a given description of a chessboard, decide its state - which player's king is under threat, and whether it is a check or a checkmate. Additionally, if it's a check, to help build up suspense, the contestants would like to know the number of valid moves the checked player has after which his king is no longer threatened.For the purposes of this problem only take into account basic moves of every chesspiece; complicated moves such as Castling, En passant, moving a pawn 2 squares or Promotion are not accepted in the known universe.InputThe first line of the input contains the integer1 ≤ t ≤ 20000- the number of chessboards.tdescriptions of a chessboard follow.The first line of each description contains two integers8 ≤ n ≤ 1018, 2 ≤ p ≤ 2*105- the length of side of the chessboard and the number of pieces currently on it.plines follow, each in the form 'x y c' , where1 ≤ x,y ≤ nindicate the coordinates of the chesspiece; the upper-left square has coordinates(1,1)while the bottom-right square is at(n,n).crepresents the type of the chesspiece - this character is from the set{KQRBHPkqrbhp}, representing in this order the king, queen, rook, bishop, knight (horse), and pawn.The pieces belonging to the White player are marked by lowercase characters; the upper side of the chessboard (lowerycoordinates) belongs to him, hence white pawns move in the positiveydirection.The pieces belonging to the Black player are marked by uppercase characters; the lower side of the chessboard (greaterycoordinates) belongs to him, hence black pawns move in the negativeydirection.A blank line follows after every chessboard description.The number or placement of the pieces may by all means be impossible to reach in a standard game of intergalactic chess, however you may assume that on every chessboard there is exactly one white king ('k') and one black king ('K'). No two pieces are on the same coordinates.Input files are 'reasonable' - that is, if a file contains a large amount of testcases, they are reasonably small. Specifically, the sum ofpwithin an input file does not exceed106.OutputFor each chessboard output one line with one of the following messages:\"Safe\", if neither players' kings are being threatened\"Impossible\", if both players' kings are being threatened\"{colour}Check - m Plausible Moves\", where{colour}is either \"Black\" or \"White\", if the respective player's king is being threatened, and there existsmvalid moves by his pieces after which his king is no longer threatened\"{colour} Checkmate\", where {colour} is either \"Black\" or \"White\",  if the respective player's king is being threatened, and there exists no valid move by any of his pieces after which his king is no longer threatenedAdditional noteThere are 16 input files \"0\" through \"15\". File 0 is the example given below. Files 1 through 7 contain testdata from CSTATE2.After submission you can view extra information about the result of each file by clicking the result text (\"accepted\",\"wrong answer\",...), such as the result of each file and the time/memory used, but no message is present like in CSTATE1 - if you are stuck, consider submitting there for a hint at what is off in your solution.ExampleInput:7\r\n8 4\r\n5 1 k\r\n4 3 H\r\n4 5 h\r\n5 7 K\r\n\r\n8 4\r\n5 2 h\r\n3 3 k\r\n6 4 H\r\n4 5 K\r\n\r\n8 6\r\n1 1 k\r\n4 1 H\r\n4 2 H\r\n2 3 H\r\n3 3 H\r\n7 6 K\r\n\r\n8 7\r\n1 1 k\r\n4 1 H\r\n4 2 H\r\n2 3 H\r\n3 3 H\r\n7 6 K\r\n2 7 r\r\n\r\n8 9\r\n1 1 K\r\n7 1 R\r\n8 1 r\r\n1 2 R\r\n3 2 h\r\n8 2 r\r\n1 5 r\r\n2 5 r\r\n6 6 k\r\n\r\n8 6\r\n1 1 k\r\n8 2 R\r\n4 4 B\r\n2 5 R\r\n7 6 K\r\n3 7 q\r\n\r\n8 9\r\n3 2 P\r\n4 2 P\r\n5 2 P\r\n3 3 P\r\n4 3 k\r\n5 3 P\r\n4 4 P\r\n5 4 p\r\n4 5 KOutput:Impossible\r\nSafe\r\nWhite Checkmate\r\nWhite Check - 1 Plausible Moves\r\nBlack Checkmate\r\nWhite Check - 1 Plausible Moves\r\nBlack Check - 5 Plausible MovesIf you have any questions, problems or suggestions, do let me know :)",
  "sample_input": "Input:7\r\n8 4\r\n5 1 k\r\n4 3 H\r\n4 5 h\r\n5 7 K\r\n\r\n8 4\r\n5 2 h\r\n3 3 k\r\n6 4 H\r\n4 5 K\r\n\r\n8 6\r\n1 1 k\r\n4 1 H\r\n4 2 H\r\n2 3 H\r\n3 3 H\r\n7 6 K\r\n\r\n8 7\r\n1 1 k\r\n4 1 H\r\n4 2 H\r\n2 3 H\r\n3 3 H\r\n7 6 K\r\n2 7 r\r\n\r\n8 9\r\n1 1 K\r\n7 1 R\r\n8 1 r\r\n1 2 R\r\n3 2 h\r\n8 2 r\r\n1 5 r\r\n2 5 r\r\n6 6 k\r\n\r\n8 6\r\n1 1 k\r\n8 2 R\r\n4 4 B\r\n2 5 R\r\n7 6 K\r\n3 7 q\r\n\r\n8 9\r\n3 2 P\r\n4 2 P\r\n5 2 P\r\n3 3 P\r\n4 3 k\r\n5 3 P\r\n4 4 P\r\n5 4 p\r\n4 5 KOutput:Impossible\r\nSafe\r\nWhite Checkmate\r\nWhite Check - 1 Plausible Moves\r\nBlack Checkmate\r\nWhite Check - 1 Plausible Moves\r\nBlack Check - 5 Plausible Moves",
  "sample_output": "Not found",
  "link": "https://www.spoj.com/problems/CSTATE3",
  "scraped_at": "2025-08-17 00:34:13"
}